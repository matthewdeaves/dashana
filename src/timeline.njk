---
layout: layouts/base.njk
permalink: /timeline/
eleventyComputed:
  title: "{{ config.viewNames.timeline }}"
---

{% if not config.tabs.timeline %}
<div class="page-disabled">
  <p>This view has been disabled in the configuration.</p>
  <a href="{{ pathPrefix }}/">Return to Dashboard</a>
</div>
{% else %}
<div class="timeline-page">
  <div class="page-header">
    <div class="page-header-top">
      <h2>{{ config.pageHeadings.timeline }}</h2>
      <p class="page-subtitle">
        {{ tasks.timeline.length }} tasks sorted by date
        {% if tasks.projectRange.start %}
          ({{ tasks.projectRange.start }} to {{ tasks.projectRange.end }})
        {% endif %}
      </p>
    </div>
    {% include "components/filter-toggle.njk" %}
  </div>

  {% if tasks.timeline.length > 0 %}
  <div class="table-container">
    <table class="timeline-table">
      <thead>
        <tr>
          {% if config.timelineColumns.name %}<th scope="col" class="col-name">Task</th>{% endif %}
          {% if config.timelineColumns.progress %}<th scope="col" class="col-completion">Progress</th>{% endif %}
          {% if config.timelineColumns.section %}<th scope="col" class="col-section">Section</th>{% endif %}
          {% if config.timelineColumns.start %}<th scope="col" class="col-start">Start</th>{% endif %}
          {% if config.timelineColumns.due %}<th scope="col" class="col-due">Due</th>{% endif %}
          {% if config.timelineColumns.duration %}<th scope="col" class="col-bar">Duration</th>{% endif %}
          {% if config.timelineColumns.status %}<th scope="col" class="col-status">Status</th>{% endif %}
          {% if config.timelineColumns.parent %}<th scope="col" class="col-parent">Parent</th>{% endif %}
          {% if config.timelineColumns.notes %}<th scope="col" class="col-notes">Notes</th>{% endif %}
          {% if config.timelineColumns.notesText %}<th scope="col" class="col-notes-text">Notes</th>{% endif %}
          {% if config.timelineColumns.custom %}
            {% for fieldName in tasks.customFieldNames %}
            <th scope="col" class="col-custom">{{ fieldName }}</th>
            {% endfor %}
          {% endif %}
          {% if config.timelineColumns.tags %}<th scope="col" class="col-tags">Tags</th>{% endif %}
        </tr>
      </thead>
      <tbody>
        {% for task in tasks.timeline %}
        <tr class="{% if task.isOverdue %}row-overdue{% endif %} {% if task.isDone %}row-done{% endif %} {% if not task.startDate and not task.dueDate %}row-no-dates{% endif %} {% if task.isSubtask %}row-subtask{% endif %}">
          {% if config.timelineColumns.name %}
          <td class="col-name">{% if task.isSubtask %}<span class="subtask-indent">‚Ü≥</span> {% endif %}{{ task.name }}</td>
          {% endif %}
          {% if config.timelineColumns.progress %}
          <td class="col-completion">
            {% if task.isDone %}
              <span class="completion-label completion-done">Done</span>
            {% else %}
              <span class="completion-label completion-open">Open</span>
            {% endif %}
          </td>
          {% endif %}
          {% if config.timelineColumns.section %}
          <td class="col-section">
            <span class="section-badge">{{ task.section }}</span>
          </td>
          {% endif %}
          {% if config.timelineColumns.start %}
          <td class="col-start">{{ task.startDate if task.startDate else '‚Äî' }}</td>
          {% endif %}
          {% if config.timelineColumns.due %}
          <td class="col-due {% if task.isOverdue %}overdue{% endif %}">
            {{ task.dueDate if task.dueDate else '‚Äî' }}
          </td>
          {% endif %}
          {% if config.timelineColumns.duration %}
          <td class="col-bar">
            {% if task.duration %}
            <div class="duration-bar-container">
              <div class="duration-bar {% if task.isDone %}done{% elif task.isOverdue %}overdue{% elif task.duration.hasStarted %}in-progress{% else %}not-started{% endif %}"
                   style="width: {{ task.duration.percentElapsed }}%">
              </div>
              <span class="duration-text">
                {% if task.isDone %}
                  {{ task.duration.days }}d ‚úì
                {% elif task.isOverdue %}
                  {{ task.duration.days }}d (overdue)
                {% elif task.duration.hasStarted %}
                  {{ task.duration.elapsed }}/{{ task.duration.days }}d
                {% else %}
                  {{ task.duration.days }}d
                {% endif %}
              </span>
            </div>
            {% else %}
            <span class="no-dates-label">No dates</span>
            {% endif %}
          </td>
          {% endif %}
          {% if config.timelineColumns.status %}
          <td class="col-status">
            {% if task.status %}
              <span class="status-badge status-{{ task.status | lower | replace(' ', '-') }}">{% if task.status == 'On track' %}‚óè{% elif task.status == 'At risk' %}‚ñ≤{% elif task.status == 'Off track' %}‚ñ†{% endif %} {{ task.status }}</span>
            {% else %}
              ‚Äî
            {% endif %}
          </td>
          {% endif %}
          {% if config.timelineColumns.parent %}
          <td class="col-parent">
            {% if task.parentTask %}
              <span class="parent-ref">{{ task.parentTask }}</span>
            {% else %}
              ‚Äî
            {% endif %}
          </td>
          {% endif %}
          {% if config.timelineColumns.notes %}
          <td class="col-notes">
            {% if task.notes %}
              <span class="notes-icon" data-notes="{{ task.notes }}" tabindex="0" role="button" aria-label="View notes">üìù</span>
            {% else %}
              ‚Äî
            {% endif %}
          </td>
          {% endif %}
          {% if config.timelineColumns.notesText %}
          <td class="col-notes-text">
            {% if task.notes %}
              {% if config.timelineColumns.notesTextMode == 'full' %}
                <span class="notes-text-full">{{ task.notes }}</span>
              {% else %}
                <span class="notes-text-preview"
                      data-notes="{{ task.notes }}"
                      tabindex="0"
                      role="button"
                      aria-label="View full notes">{{ task.notes | truncate(config.notesTextPreviewLength) }}</span>
              {% endif %}
            {% else %}
              ‚Äî
            {% endif %}
          </td>
          {% endif %}
          {% if config.timelineColumns.custom %}
            {% for fieldName in tasks.customFieldNames %}
            <td class="col-custom">
              {% if task.customFields and task.customFields[fieldName] %}
                <span class="custom-field-value">{{ task.customFields[fieldName] }}</span>
              {% else %}
                ‚Äî
              {% endif %}
            </td>
            {% endfor %}
          {% endif %}
          {% if config.timelineColumns.tags %}
          <td class="col-tags">
            {% if task.tags.length > 0 %}
              {% for tag in task.tags %}
                <span class="tag-badge">{{ tag }}</span>
              {% endfor %}
            {% else %}
              ‚Äî
            {% endif %}
          </td>
          {% endif %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% else %}
  <p class="empty-state">No tasks found.</p>
  {% endif %}
</div>
{% endif %}
